!function(a){"function"==typeof define&&define.amd?define(["jquery","moment"],a):"object"==typeof exports?module.exports=a(require("jquery"),require("moment")):this.RactiveValidator=a(jQuery,moment)}(function(a,b){function c(a){var b=c.cache[a];if(!b){var d={};b=c.cache[a]={id:a,exports:d},c.modules[a].call(d,b,d)}return b.exports}return c.cache=[],c.modules=[function(b,c){b.exports=a},function(a,c){a.exports=b},function(a,b){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(0),h=d(g),i=function(){function a(b){var c=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];e(this,a),this.selector=b,this.fields={},this.errorClass=c.errorClass||"has-error",this.messageClass=c.messageClass||"validation-message";var d=this;b.each(function(){h["default"](this).find(":input").each(function(){var a=h["default"](this),b=a.attr("name");d.fields[b]?d.fields[b].push(a):d.fields[b]=[a]})})}return f(a,[{key:"get",value:function(a){var b=this.fields[a];if(b){var c=b.map(function(a){return a.val()});return c.length>1?c:c[0]}}},{key:"set",value:function(a,b){var c=this.fields[a];c&&c.forEach(function(a){a.val(b)})}},{key:"observe",value:function(a,b){this.selector.find('[name="'+a+'"]').on("change",function(){b(h["default"](this).val(),null,a)})}},{key:"setError",value:function(a,b){var c=this.fields[a],d=this;c&&c.forEach(function(a){a.addClass(d.errorClass),a.next("."+d.messageClass).remove(),a.after(h["default"]("<span>").addClass(d.messageClass).text(b))})}},{key:"clearError",value:function(a,b){var c=this.fields[a],d=this;c&&c.forEach(function(a){a.removeClass(d.errorClass),a.next("."+d.messageClass).remove()})}}]),a}();b["default"]=i,a.exports=b["default"]},function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){c(this,a),this.model=b||{}}return e(a,[{key:"get",value:function(a){if(!a)return this.model;var b=this.expandKeypath(a),c=this,d=b.map(function(a){var b=c.getObj(c.model,a),d=b.object,e=b.child;return d[e]});return 1===d.length?d[0]:d}},{key:"set",value:function(a,b){var c=this.expandKeypath(a);for(var d in c){var e=this.getObj(this.model,a),f=e.object,g=e.child;f[g]=b}}},{key:"expandKeypath",value:function(a){var b=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],c=a.match(/^(([^\*]+)\.)?\*(\..*)?$/)||[],e=d(c,4),f=e[0],g=e[1],h=e[2],i=e[3];if(f){var j=this.get(h);for(var k in j)this.expandKeypath(g+k+i,b)}else b.push(a);return b}},{key:"getObj",value:function(a,b){var c=b.indexOf(".");if(-1===c)return{object:a,child:b};var e=b.match(/^([^\.]+)\.(([^\.]+).*)$/),f=d(e,4),g=(f[0],f[1]),h=f[2],i=f[3];return a.hasOwnProperty(g)||(a[g]=isNaN(parseInt(i))?{}:[]),this.getObj(a[g],h)}}]),a}();b["default"]=f,a.exports=b["default"]},function(a,b){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c(0),i=d(h),j=c(2),k=d(j),l=c(1),m=d(l),n=c(3),o=d(n),p=function(){function a(){e(this,a);var b=Array.prototype.slice.call(arguments).reverse(),c=f(b,3);this.rules=c[0],this.model=c[1],this.basePath=c[2],this.basePath=this.basePath?this.basePath+".":"",this.validators=a.validators,this.enabled=!0,this.errorSuffix="Msg",this.model&&(this.model=this.wrapModel()),this.model&&this.model.observe&&this.observeModel()}return g(a,[{key:"observeModel",value:function(){var a=this,b=this,c={valid:!0,model:this.wrapModel(),errors:new o["default"],data:new o["default"],groups:[],immediate:!1},d=function(d){a.model.observe(d,function(a,e,f){b.enabled&&b.validateKeypath(a,f,c,b.rules[d])},{init:!1})};for(var e in this.rules)d(e)}},{key:"enable",value:function(a){this.enabled=a;for(var b in this.rules)this.model.clearError(this.basePath+b)}},{key:"validate",value:function(a){var b=this,c={valid:!0,model:this.wrapModel(a),errors:new o["default"],data:new o["default"],groups:[],immediate:null!=a},d=[];for(var e in this.rules){var f=this.rules[e],g=this.validateWildcardKeypath(this.basePath+e,c,f);g&&g.then&&d.push(g)}var h=function(){return{valid:c.valid,errors:c.errors.model,data:c.data.get(b.basePath.substring(0,b.basePath.length-1))}};return d.length?Promise.all(d).then(h):h()}},{key:"validateWildcardKeypath",value:function(a,b,c){var d=b.model.expandKeypath(a),e=[];for(var f in d){var g=this.validateKeypath(b.model.get(d[f]),d[f],b,c);g&&g.then&&e.push(g)}return e.length?Promise.all(e):void 0}},{key:"validateKeypath",value:function(a,b,c,d){var e=[];for(var f in d)e.push({key:f,value:d[f]});var g=this.validateKeypathRules(a,b,c,e),h=function(d){c.valid&&c.data.set(b,"undefined"!=typeof d?d:a)};return g&&g.then?g.then(h):void h(g)}},{key:"validateKeypathRules",value:function(a,b,c,d,e,f){var g=this;void 0===e&&(e=0);var h=d[e],i=void 0;if(this.validators.hasOwnProperty(h.key))i=this.validators[h.key];else{if("function"!=typeof h.value)throw new Error("validator "+h.key+" not defined");i=h.value}var j=i.call(this,a,h.value,c),k=function(h){return h.valid?(c.immediate||c.model.clearError(b),"undefined"!=typeof h.coerced&&(f=h.coerced),e+1<d.length?g.validateKeypathRules(a,b,c,d,e+1,f):f):(c.valid=!1,c.errors.set(b,h.error),c.model.setError(b,h.error),void 0)};if(j){if(j.then){if(Promise)return j.then(k);throw new Error("validator "+h.key+" returns a promise and you don't have promise support")}return k(j)}throw new Error("validator "+h.key+" did not return a value")}},{key:"wrapModel",value:function(a){var b=this;return a=a||this.model,i["default"]&&a instanceof i["default"]?a=new k["default"](a):(a.get&&a.set||(a=new o["default"](a)),a.expandKeypath||(a.expandKeypath=o["default"].prototype.expandKeypath),a.setError||(a.setError=function(a,c){this.set(a+b.errorSuffix,c)}),a.clearError||(a.clearError=function(a){this.set(a+b.errorSuffix)})),a}}]),a}();a.exports=p;var q={validators:{moment:c(5),password:c(6),positive:c(7),required:c(8),type:c(9)}};q.validators.moment=q.validators.moment(m["default"]),p.validators=q.validators,p.ObjectModel=o["default"],p.FormModel=k["default"]},function(a,b){"use strict";a.exports=function(a){return function(b,c){var d,c,e,f;if(!a)throw new Error("you don't have moment support");return"string"!=typeof c&&(f=c,c=f.format,d=f.coerce),"undefined"==typeof b||null===b||""===b?{valid:!0}:(e=a.utc(b,c,!0),e.isValid()?d===!0?{valid:!0,coerced:e}:"date"===d?{valid:!0,coerced:e.toDate()}:"string"==typeof d?{valid:!0,coerced:e.format(d)}:{valid:!0}:{valid:!1,error:"must be "+c})}}},function(a,b){"use strict";a.exports=function(a,b,c){return a===c.model.get(b)?{valid:!0}:{valid:!1,error:"passwords must match"}}},function(a,b){"use strict";a.exports=function(a,b){return a>=0?{valid:!0}:{valid:!1,error:"must be positive"}}},function(a,b){"use strict";a.exports=function c(a,c,b){var d,e,f,g,h;if(c){if("string"==typeof c){if(h=c.match(/([^\.]+)=(.+)/)||[],g=h[0],e=h[1],f=h[2],!g)throw new Error("invalid require rule: "+c);return d=b.groups[e],"undefined"==typeof a||null===a||""===a?d===f?{valid:!1,error:"required"}:{valid:!0}:void 0===d?(b.groups[e]=f,{valid:!0}):d===f?{valid:!0}:{valid:!1,error:"not required"}}return"undefined"==typeof a||null===a||""===a?{valid:!1,error:"required"}:{valid:!0}}return{valid:!0}}},function(a,b){"use strict";a.exports=function c(a,c,b){if("undefined"==typeof a||null===a)return{valid:!0};if("string"===c)return"string"!=typeof a?{valid:!1,error:"must be a string"}:{valid:!0};if("integer"===c)return""===a?{valid:!0,coerced:null}:"number"==typeof a&&a%1!==0||"number"!=typeof a&&b.immediate||"undefined"!=typeof a&&null!==a&&""!==a&&!/^(\-|\+)?([0-9]+)$/.test(a)?{valid:!1,error:"must be a whole number"}:{valid:!0,coerced:Number(a)};if("decimal"===c)return""===a?{valid:!0,coerced:null}:"number"!=typeof a&&b.immediate||"undefined"!=typeof a&&null!==a&&""!==a&&!/^(\-|\+)?([0-9]+(\.[0-9]+)?)$/.test(a)?{valid:!1,error:"must be a decimal"}:{valid:!0,coerced:Number(a)};if("boolean"===c)return""===a?{valid:!0,coerced:null}:"boolean"!=typeof a&&b.immediate||"undefined"!=typeof a&&null!==a&&""!==a&&!/^(true|false)$/.test(a)?{valid:!1,error:"must be a boolean"}:{valid:!0,coerced:"true"===a||a===!0};throw new Error("unknown data type "+c)}}],c(4)});