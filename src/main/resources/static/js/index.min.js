!function(a){"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?module.exports=a():this.RactiveValidator=a()}(function(){function a(b){var c=a.cache[b];if(!c){var d={};c=a.cache[b]={id:b,exports:d},a.modules[b].call(d,c,d)}return c.exports}return a.cache=[],a.modules=[function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=function(){function a(b){var d=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];c(this,a),this.fields={},this.errorClass=d.errorClass||"has-error",this.messageClass=d.messageClass||"validation-message";var e=this;b.each(function(){$(this).find(":input").each(function(){var a=$(this),b=a.attr("name");e.fields[b]?e.fields[b].push(a):e.fields[b]=[a]})})}return d(a,[{key:"get",value:function(a){var b=this.fields[a];if(b){var c=b.map(function(a){return a.val()});return c.length>1?c:c[0]}}},{key:"set",value:function(a,b){var c=this.fields[a];c&&c.forEach(function(a){a.val(b)})}},{key:"setError",value:function(a,b){var c=this.fields[a],d=this;c&&c.forEach(function(a){a.addClass(d.errorClass),a.next("."+d.messageClass).remove(),a.after($("<span>")["class"](d.messageClass).text(b))})}},{key:"clearError",value:function(a,b){var c=this.fields[a],d=this;c&&c.forEach(function(a){a.removeClass(d.errorClass),a.next("."+d.messageClass).remove()})}}]),a}();b["default"]=e,a.exports=b["default"]},function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){c(this,a),this.model=b||{}}return e(a,[{key:"get",value:function(a){if(!a)return this.model;var b=this.expandKeypath(a),c=this,d=b.map(function(a){var b=c.getObj(c.model,a),d=b.object,e=b.child;return d[e]});return 1===d.length?d[0]:d}},{key:"set",value:function(a,b){var c=this.expandKeypath(a);for(var d in c){var e=this.getObj(this.model,a),f=e.object,g=e.child;f[g]=b}}},{key:"expandKeypath",value:function(a){var b=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],c=a.match(/^(([^\*]+)\.)?\*(\..*)?$/)||[],e=d(c,4),f=e[0],g=e[1],h=e[2],i=e[3];if(f){var j=this.get(h);for(var k in j)this.expandKeypath(g+k+i,b)}else b.push(a);return b}},{key:"getObj",value:function(a,b){var c=b.indexOf(".");if(-1===c)return{object:a,child:b};var e=b.match(/^([^\.]+)\.(([^\.]+).*)$/),f=d(e,4),g=(f[0],f[1]),h=f[2],i=f[3];return a.hasOwnProperty(g)||(a[g]=isNaN(parseInt(i))?{}:[]),this.getObj(a[g],h)}}]),a}();b["default"]=f,a.exports=b["default"]},function(b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a(0),i=d(h),j=a(1),k=d(j);c.ObjectModel=k["default"];var l=function(){function a(){e(this,a);var b=Array.prototype.slice.call(arguments).reverse(),c=f(b,3);this.rules=c[0],this.model=c[1],this.basePath=c[2],this.basePath=this.basePath?this.basePath+".":"",this.validators=a.validators,this.enabled=!0,this.errorSuffix="Msg",this.model&&this.model.observe&&this.observeModel()}return g(a,[{key:"observeModel",value:function(){var a=this,b=this,c={valid:!0,model:this.wrapModel(),errors:new k["default"],data:new k["default"],groups:[],immediate:!1},d=function(d){a.model.observe(d,function(a,e,f){b.enabled&&b.validateKeypath(a,f,c,b.rules[d])},{init:!1})};for(var e in this.rules)d(e)}},{key:"enable",value:function(a){this.enabled=a;for(var b in this.rules)this.model.clearError(this.basePath+b)}},{key:"validate",value:function(a){var b=this,c={valid:!0,model:this.wrapModel(a),errors:new k["default"],data:new k["default"],groups:[],immediate:null!=a},d=[];for(var e in this.rules){var f=this.rules[e],g=this.validateWildcardKeypath(this.basePath+e,c,f);g&&g.then&&d.push(g)}var h=function(){return{valid:c.valid,errors:c.errors.model,data:c.data.get(b.basePath.substring(0,b.basePath.length-1))}};return d.length?Promise.all(d).then(h):h()}},{key:"validateWildcardKeypath",value:function(a,b,c){var d=b.model.expandKeypath(a),e=[];for(var f in d){var g=this.validateKeypath(b.model.get(d[f]),d[f],b,c);g&&g.then&&e.push(g)}return e.length?Promise.all(e):void 0}},{key:"validateKeypath",value:function(a,b,c,d){var e=[];for(var f in d)e.push({key:f,value:d[f]});var g=this.validateKeypathRules(a,b,c,e),h=function(d){c.valid&&c.data.set(b,"undefined"!=typeof d?d:a)};return g&&g.then?g.then(h):void h(g)}},{key:"validateKeypathRules",value:function(a,b,c,d,e,f){var g=this;void 0===e&&(e=0);var h=d[e],i=void 0;if(this.validators.hasOwnProperty(h.key))i=this.validators[h.key];else{if("function"!=typeof h.value)throw new Error("validator "+h.key+" not defined");i=h.value}var j=i.call(this,a,h.value,c),k=function(h){return h.valid?(c.immediate||c.model.clearError(b),"undefined"!=typeof h.coerced&&(f=h.coerced),e+1<d.length?g.validateKeypathRules(a,b,c,d,e+1,f):f):(c.valid=!1,c.errors.set(b,h.error),c.immediate||c.model.setError(b,h.error),void 0)};if(j){if(j.then){if(Promise)return j.then(k);throw new Error("validator "+h.key+" returns a promise and you don't have promise support")}return k(j)}throw new Error("validator "+h.key+" did not return a value")}},{key:"wrapModel",value:function(a){var b=this;return a=a||this.model,$&&a instanceof $?a=new i["default"](a):(a.get&&a.set||(a=new k["default"](a)),a.expandKeypath||(a.expandKeypath=k["default"].prototype.expandKeypath),a.setError||(a.setError=function(a,c){b.model.set(a+b.errorSuffix,c)}),a.clearError||(a.clearError=function(a){b.model.set(a+b.errorSuffix)})),a}}]),a}();c["default"]=l,l.validators={required:function(a,b,c){var d,e,f,g,h;if(b){if("string"==typeof b){if(h=b.match(/([^\.]+)=(.+)/)||[],g=h[0],e=h[1],f=h[2],!g)throw new Error("invalid require rule: "+b);return d=c.groups[e],"undefined"==typeof a||null===a||""===a?d===f?{valid:!1,error:"required"}:{valid:!0}:void 0===d?(c.groups[e]=f,{valid:!0}):d===f?{valid:!0}:{valid:!1,error:"not required"}}return"undefined"==typeof a||null===a||""===a?{valid:!1,error:"required"}:{valid:!0}}return{valid:!0}},password:function(a,b,c){return a===c.model.get(b)?{valid:!0}:{valid:!1,error:"passwords must match"}},moment:function(a){function b(b,c){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(function(a,b){var c,b,d,e;return"string"!=typeof b&&(e=b,b=e.format,c=e.coerce),"undefined"==typeof a||null===a||""===a?{valid:!0}:(d=moment.utc(a,b,!0),d.isValid()?c===!0?{valid:!0,coerced:d}:"date"===c?{valid:!0,coerced:d.toDate()}:"string"==typeof c?{valid:!0,coerced:d.format(c)}:{valid:!0}:{valid:!1,error:"must be "+b})}),type:function(a,b,c){if("undefined"==typeof a||null===a)return{valid:!0};if("string"===b)return"string"!=typeof a?{valid:!1,error:"must be a string"}:{valid:!0};if("integer"===b)return""===a?{valid:!0,coerced:null}:"number"==typeof a&&a%1!==0||"number"!=typeof a&&c.immediate||"undefined"!=typeof a&&null!==a&&""!==a&&!/^(\-|\+)?([0-9]+)$/.test(a)?{valid:!1,error:"must be a whole number"}:{valid:!0,coerced:Number(a)};if("decimal"===b)return""===a?{valid:!0,coerced:null}:"number"!=typeof a&&c.immediate||"undefined"!=typeof a&&null!==a&&""!==a&&!/^(\-|\+)?([0-9]+(\.[0-9]+)?)$/.test(a)?{valid:!1,error:"must be a decimal"}:{valid:!0,coerced:Number(a)};if("boolean"===b)return""===a?{valid:!0,coerced:null}:"boolean"!=typeof a&&c.immediate||"undefined"!=typeof a&&null!==a&&""!==a&&!/^(true|false)$/.test(a)?{valid:!1,error:"must be a boolean"}:{valid:!0,coerced:"true"===a||a===!0};throw new Error("unknown data type "+b)},positive:function(a,b){return a>=0?{valid:!0}:{valid:!1,error:"must be positive"}}}}],a(2)});